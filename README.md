# RAG Система

Простая система Retrieval-Augmented Generation (RAG) с чистой архитектурой, использующая внешнее AI API и SQLite базу данных.

## Архитектура

Система реализована по принципам чистой архитектуры:

- **Domain**: Содержит бизнес-сущности и интерфейсы
- **Application**: Содержит бизнес-логику (сервисы)
- **Infrastructure**: Содержит реализации интерфейсов (база данных, API клиент)

## Зависимости

- `github.com/jmoiron/sqlx` - для работы с SQLite
- `github.com/mattn/go-sqlite3` - драйвер SQLite
- `gopkg.in/yaml.v3` - для парсинга YAML конфигурации
- `github.com/rs/zerolog` - для логирования (опционально)
- `github.com/stretchr/testify` - для тестирования (опционально)

## Установка и настройка

1. Убедитесь, что у вас установлен Go
2. Инициализируйте модули:
```bash
go mod tidy
```

3. Настройте конфигурацию в `config/config.yaml`
4. Установите API ключ в переменную окружения (рекомендуется):
```bash
export AI_API_KEY="ваш_api_ключ"
```

## Использование

### Запуск демо-режима:
```bash
go run main.go -action=demo
```

### Индексация документа:
```bash
go run main.go -action=index -doc=path/to/your/document.txt
```

### Поиск с генерацией ответа:
```bash
go run main.go -action=search -query="Ваш поисковый запрос"
```

### Параметры запуска:
- `-config` - путь к файлу конфигурации (по умолчанию `config/config.yaml`)
- `-db` - путь к файлу базы данных SQLite (по умолчанию `./rag_system.db`)
- `-action` - действие: `serve`, `index`, `search`, `demo`
- `-doc` - путь к документу для индексации (для действия `index`)
- `-query` - поисковый запрос (для действия `search`)

## Функциональность

- **Индексация документов**: Загрузка документов и разбиение на фрагменты
- **Поиск**: Нахождение релевантных фрагментов по поисковому запросу
- **Генерация**: Создание ответа на основе найденных фрагментов с использованием AI
- **Хранение**: Использование SQLite для хранения документов и фрагментов
- **Конфигурация**: Поддержка конфигурации через YAML файл и переменные окружения

## Структура проекта

```
rag-system/
├── main.go                 # Главный исполняемый файл
├── config/
│   └── config.yaml         # Файл конфигурации
├── src/
│   ├── domain/             # Доменные сущности и интерфейсы
│   │   ├── models.go
│   │   └── repository.go
│   ├── application/        # Сервисы приложения
│   │   ├── service.go
│   │   └── rag_service.go
│   └── infrastructure/     # Реализация инфраструктурных компонентов
│       ├── repository.go   # Репозиторий документов
│       └── ai/             # Клиент для работы с AI API
│           └── client.go
├── go.mod
├── go.sum
├── tests/                  # Тесты (будут добавлены)
└── docs/                   # Документация (будет добавлена)
```

## Безопасность

- API ключ передается через переменные окружения (не хранится в коде)
- Все ошибки обрабатываются корректно
- Ввод пользователя валидируется

## Тестирование

Для запуска тестов:
```bash
go test ./...
```